# **–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ15**

üîñ–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–ª—è –∫—É—Ä—Å–∞ [Administrator Linux.Professional](https://otus.ru/lessons/linux-professional/)

## **PAM**

1. –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∫—Ä–æ–º–µ –≥—Ä—É–ø–ø—ã admin –ª–æ–≥–∏–Ω –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ (—Å—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ), –±–µ–∑ —É—á–µ—Ç–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤
2. –î–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∞–≤–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–æ–∫–µ—Ä–æ–º –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ç—å –¥–æ–∫–µ—Ä —Å–µ—Ä–≤–∏—Å

# **–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

–ó–¥–µ—Å—å:
- `readme.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
- `Vagrantfile` - —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è `Vagrant`
- `pam_script.sh` - —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–∞–≤

# **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è ‚Ññ15**

–ü–æ–¥–Ω–∏–º–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π
```
# –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–π—Ç–∏ –≤ –ª—é–±–æ–π –¥–µ–Ω—å, –ø–∞—Ä–æ–ª—å 123
ssh can_user@192.168.10.10

# –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–π—Ç–∏ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏, –ø–∞—Ä–æ–ª—å 123
ssh cant_user@192.168.10.10

# –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–æ–∫–µ—Ä, –ø–∞—Ä–æ–ª—å 123
ssh docker_user@192.168.10.10
sudo systemctl restart docker.service
```

# ***–ó–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞—Ö–æ–¥–∏—Ç—å –ø–æ ssh –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ***

–î–æ–±–∞–≤–ª—è–µ–º –≥—Ä—É–ø–ø—É `admin` –∏ –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `can_user` –¥–æ–±–∞–≤–ª—è–µ–º –≤ –≥—Ä—É–ø–ø—É `admin` 
```
groupadd admin
useradd -G admin can_user
useradd -G cant_user
```
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞—Ä–æ–ª–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```
echo "123" | sudo passwd --stdin can_user &&\
echo "123" | sudo passwd --stdin cant_user
```

```
sed -i "2i auth       required     pam_exec.so /usr/local/bin/pam_script.sh"  /etc/pam.d/sshd
```
–°–æ–∑–¥–∞–µ–º —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥—Ä—É–ø–ø–µ `admin`.
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –≥—Ä—É–ø–ø–µ, –æ–Ω —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ –ª—é–±–æ–π –¥–µ–Ω—å, –∏–Ω–∞—á–µ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏. –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º.
```
cat <<'EOF' > /usr/local/bin/pam_script.sh
#!/bin/bash
if [[ `grep $PAM_USER /etc/group | grep 'admin'` ]]
then
exit 0
fi
if [[ `date +%u` > 1 ]]
then
exit 1
fi
EOF

chmod +x /usr/local/bin/pam_script.sh
```
–ü—Ä–∞–≤–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `sshd_config`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—Ö–æ–¥–∞ –ø–æ –ø–∞—Ä–æ–ª—é –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ª—É–∂–±—É
```
sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
systemctl restart sshd
```

# ***–î–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∞–≤–∞ –Ω–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –¥–æ–∫–µ—Ä–∞***

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º docker, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É –∏ –∑–∞–ø—É—Å–∫–∞–µ–º
```
yum install yum-utils -y
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum install docker-ce docker-ce-cli containerd.io -y
systemctl enable --now docker
```
–°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `docker_user` –∏ –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –≥—Ä—É–ø–ø—É `docker`
```
useradd docker_user
echo "123" | sudo passwd --stdin docker_user
usermod -aG docker docker_user
```
–î–æ–±–∞–≤–ª—è–µ–º –≤ —Ñ–∞–π–ª `/etc/sudoers` –ø—Ä–∞–≤–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `docker_user` –Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Ä–≤–∏—Å–∞ 
```
echo %docker_user ALL=NOPASSWD: /bin/systemctl restart docker.service>>/etc/sudoers
```