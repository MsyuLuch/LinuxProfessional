# **–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ13**

üîñ–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–ª—è –∫—É—Ä—Å–∞ [Administrator Linux.Professional](https://otus.ru/lessons/linux-professional/)

## **Docker, docker-compose, dockerfile**
 
- –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –∫–∞—Å—Ç–æ–º–Ω—ã–π –æ–±—Ä–∞–∑ nginx. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ nginx –¥–æ–ª–∂–µ–Ω –æ—Ç–¥–∞–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É nginx)
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∏ –æ–±—Ä–∞–∑–æ–º. –í—ã–≤–æ–¥ –æ–ø–∏—à–∏—Ç–µ –≤ –¥–æ–º–∞—à–Ω–µ–º –∑–∞–¥–∞–Ω–∏–∏.
- –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å: –ú–æ–∂–Ω–æ –ª–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å–æ–±—Ä–∞—Ç—å —è–¥—Ä–æ?
- –°–æ–±—Ä–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—à–∏—Ç—å –≤ docker hub –∏ –¥–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
- –°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –æ–±—Ä–∞–∑—ã nginx –∏ php, –æ–±—ä–µ–¥–∏–Ω–∏—Ç–µ –∏—Ö –≤ docker-compose

# **–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

–ó–¥–µ—Å—å:
- `readme.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
- `dockerfile` - —Ñ–∞–π–ª –¥–ª—è —Å–±–æ—Ä–∫–∏ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ NGINX
- `default.conf` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª NGINX
- `index.html` - –∫–∞—Å—Ç–æ–º–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—á–∫–∞ –¥–ª—è NGINX (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∏–∑ dockerfile)
- `docker-compose.yml` -  —Ñ–∞–π–ª –¥–ª—è —Å–±–æ—Ä–∫–∏ NGINX –∏ php-fpm
- `index.php` - –∫–∞—Å—Ç–æ–º–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—á–∫–∞ –¥–ª—è NGINX (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∏–∑ docker-compose)

# **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è ‚Ññ13**

# ***–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ NGINX***

–û–ø–∏—à–µ–º Dockerfile –¥–ª—è –±—É–¥—É—â–µ–≥–æ –æ–±—Ä–∞–∑–∞ NGINX:
```
# –£–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–æ–π –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
FROM ubuntu:latest
 
# –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ –Ω–æ–≤–æ–º —Å–ª–æ–µ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –æ–±—Ä–∞–∑–∞
# –û–±–Ω–æ–≤–ª—è–µ–º –û–°
RUN apt-get update && apt-get upgrade -y
 
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º NGINX
RUN apt-get install nginx -y
 
# –£–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
EXPOSE 80

#–ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 
COPY index.html /var/www/html/index.html

# –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ–º–∞–Ω–¥–∞, –∑–∞–ø—É—Å–∫–∞–µ–º–∞—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
CMD ["nginx", "-g", "daemon off;"]
```
–°–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑
```
docker build -t mashkinasu/my-nginx:v1 .
```
–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ DockerHub –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ –Ω–µ–≥–æ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–±—Ä–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑:
```
docker login
....
docker push mashkinasu/my-nginx:v1
```
–ó–∞–ø—É—Å—Ç–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Å–∫–∞—á–∏–≤–∞—è –æ–±—Ä–∞–∑ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –Ω–∞ –ø–æ—Ä—Ç—É 8080:
```
docker run -d -p 8080:80 mashkinasu/my-nginx:v1
```
–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ `localhost:8080` - –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∫–∞—Å—Ç–æ–º–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `inde.html`
–¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è.

# ***–û–±—ä–µ–¥–∏–Ω—è–µ–º –æ–±—Ä–∞–∑—ã NGINX –∏ PHP –≤ docker-compose***
–û–ø–∏—à–µ–º `docker-compose.yml`
```
# –í–µ—Ä—Å–∏—è docker-compose 
version: "3.7"
# –°–ø–∏—Å–æ–∫ –Ω–∞—à–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
services:
  web:
    # –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –æ–±—Ä–∞–∑ nginx
    image: mashkinasu/my-nginx:v1
    container_name: web
    # nginx –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –ø–æ—Å–ª–µ php –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    depends_on:
      - php
    # –º–æ–Ω—Ç–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, —Å–ª–µ–≤–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –º–∞—à–∏–Ω–µ, —Å–ø—Ä–∞–≤–∞ - –∫—É–¥–∞ –æ–Ω–∏ –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
    volumes:
      - ./default.conf:/etc/nginx/sites-available/default
      - ./default.conf:/etc/nginx/sites-enabled/default
      - ./index.php:/var/www/index.php
    # –º–∞–ø–∏–º –ø–æ—Ä—Ç—ã
    ports:
      - "8080:80"
    # –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ç—å front_net –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∞–ª–∏–∞—Å
    networks:
      front_net:
        aliases:
          - web

  php:
    # –æ–±—Ä–∞–∑ php-fpm –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è DockerHub
    image: bitnami/php-fpm:7.4.24
    container_name: php
    # –º–æ–Ω—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª index.php
    volumes:
      - ./index.php:/var/www/index.php
    # –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ç—å front_net –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∞–ª–∏–∞—Å
    networks:
      front_net:
        aliases:
          - php

# –°–µ—Ç—å Docker
networks:
  front_net:
    ipam:
      driver: default

```
–ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ `localhost:8080` - –¥–æ–ª–∂–Ω–∞ –æ—Ç—Ä–∞–∑–∏—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è `phpinfo()`
```
docker-compose up -d
```
–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:
```
user@user-VirtualBox:~/LinuxProfessional/homework-13$ docker ps -a
CONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS                      PORTS      NAMES
def279444507   mashkinasu/my-nginx:v1   "nginx -g 'daemon of‚Ä¶"   10 minutes ago   Exited (1) 10 minutes ago              web
5b5cec287189   bitnami/php-fpm:7.4.24   "php-fpm -F --pid /o‚Ä¶"   10 minutes ago   Up 10 minutes               9000/tcp   php
```
# ***–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∏ –æ–±—Ä–∞–∑–æ–º***
![Docker](https://github.com/MsyuLuch/LinuxProfessional/blob/main/homework-13/images/image.png)

# ****–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ (Image)****

–û–±—Ä–∞–∑ Docker ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä —Ñ–∞–π–ª–æ–≤, —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö –≤ –≤–∏–¥–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. 
–û–±—Ä–∞–∑ —Å—Ç—Ä–æ–∏—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∑–∞–≤–∏—Å—è—â–µ–π –æ—Ç –≤–µ—Ä—Å–∏–∏ —è–¥—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞. 
–ö–æ–º–∞–Ω–¥–∞ Docker run –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤, –Ω–∞–∑—ã–≤–∞–µ–º—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏, –∑–∞–ø—É—Å–∫–∞–µ–º—ã–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±—Ä–∞–∑–æ–≤ Docker. 
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–∑ –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. 

–û–±—Ä–∞–∑ –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫ ¬´—Å—É—â–Ω–æ—Å—Ç—å¬ª –∏–ª–∏ ¬´–æ–±—â–∏–π –≤–∏–¥¬ª (union view) —Å—Ç–µ–∫–∞ —Å–ª–æ–µ–≤ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è.

# ****–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (Container)****

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî –±–∞–∑–æ–≤–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è, –ø–æ–∫—Ä—ã–≤–∞—é—â–∞—è –∫–æ–¥ –∏ –≤—Å–µ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ, –±—ã—Å—Ç—Ä–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è. 
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Docker –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±—Ä–∞–∑–∞ Docker. 
–≠—Ç–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π –ø–∞–∫–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. 

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å ¬´—Å—É—â–Ω–æ—Å—Ç—å—é¬ª —Å—Ç–µ–∫–∞ —Å–ª–æ–µ–≤ —Å –≤–µ—Ä—Ö–Ω–∏–º —Å–ª–æ–µ–º –¥–ª—è –∑–∞–ø–∏—Å–∏. 

# ***–ú–æ–∂–Ω–æ –ª–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å–æ–±—Ä–∞—Ç—å —è–¥—Ä–æ?***

Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–¥—Ä–æ ‚Äã‚Äã–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —è–¥—Ä–∞. –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ –º–∞—à–∏–Ω–µ, —Å–æ–≤–º–µ—Å—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–æ ¬´–≥–ª–∞–≤–Ω–æ–µ¬ª —è–¥—Ä–æ.
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Docker Engine –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Ö–æ—Å—Ç–∞, —Ä–∞–∑–¥–µ–ª—è—è —è–¥—Ä–æ ‚Äã‚Äã—Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏. 