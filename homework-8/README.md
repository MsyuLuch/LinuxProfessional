# **–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ8**

üîñ–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–ª—è –∫—É—Ä—Å–∞ [Administrator Linux.Professional](https://otus.ru/lessons/linux-professional/)

## **Bash** 
 
–ù–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫—Ä–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑ –≤ —á–∞—Å –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –ø–æ—á—Ç—É:
 
 - X IP –∞–¥—Ä–µ—Å–æ–≤ (—Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª-–≤–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤) —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª-–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ c –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞;
 - Y –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ (—Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª-–≤–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤) —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª-–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ c –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞;
 - –≤—Å–µ –æ—à–∏–±–∫–∏ c –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞;
 - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–¥–æ–≤ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Ö –∫–æ–ª-–≤–∞ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞.
 –í –ø–∏—Å—å–º–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ–ø–∏—Å–∞–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –º—É–ª—å—Ç–∏–∑–∞–ø—É—Å–∫–∞.

# **–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç https://github.com/MsyuLuch/LinuxProfessional/tree/main/homework-8

–ó–¥–µ—Å—å:
- `readme.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
- `script_auto.sh` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è cron 
- `script_test.sh` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

# **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è ‚Ññ8**

***–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è cron***

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ cron, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª /etc/crontab –¥–æ–±–∞–≤–∏–≤ —Å—Ç—Ä–æ–∫—É:
```
0 */1 * * * /usr/bin/flock /var/tmp/myscript.lock /home/script_auto.sh > /dev/null 2>&1
```

`script_auto.sh` –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Ä–∞–∑ –≤ —á–∞—Å, –≤—ã–±–∏—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ log-—Ñ–∞–π–ª–∞, —Å–æ–≥–ª–∞—Å–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∑–∞–¥–∞–Ω–Ω—ã–º –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞.
–í –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞—â–∏—Ç—ã –æ—Ç –º—É–ª—å—Ç–∏–∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ flock. –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å—Ç–∏—Ç `/home/script_auto.sh` –∏ —Å–æ–∑–¥–∞—Å—Ç lock-—Ñ–∞–π–ª –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞. 
–ü–æ–∫–∞ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ–≤—ã–π –≤—ã–∑–æ–≤ –¥–∞–Ω–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç. 


–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –±—É–¥–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª mail.txt, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø–æ—á—Ç—É, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```
mail -s "cron mail" name@address.ext < $mailfile
```
–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ—á—Ç–∞ –º–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Å–∫—Ä–∏–ø—Ç–µ. 

***–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞***

–í –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞—â–∏—Ç—ã –æ—Ç –º—É–ª—å—Ç–∏–∑–∞–ø—É—Å–∫–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `lock.sh`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. 
–ö–æ–≥–¥–∞ —Å–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `rm -f $LOCKFILE` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ:
 
`trap [action] [signal]`
 
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ EXIT (0) –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, SIGINT - 2) –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø—Ä–∏ –ª—é–±–æ–º –≤—ã—Ö–æ–¥–µ. 
```
LOCKFILE=/tmp/lockfile

if [[ -f $LOCKFILE ]]
then
  echo "Lockfile exists, try again later..." >&2
  exit 1
fi
  echo "Process is running ( PID: $$ )" > $LOCKFILE
  trap 'rm -f $LOCKFILE' EXIT
 # do something...
```

***–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞***

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

1 - log-—Ñ–∞–π–ª

2 - —Ç—Ä–µ–±—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ IP –∞–¥—Ä–µ—Å–æ–≤ (—Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª-–≤–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤)

3 - —Ç—Ä–µ–±—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ (—Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª-–≤–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤)

4 - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –µ—Å–ª–∏ –ø—É—Å—Ç–æ–π, —Ç–æ –≤—ã–±–æ—Ä–∫–∞ –±—É–¥–µ—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—ã–π —á–∞—Å, –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–∞–¥–∞–Ω, —Ç–æ –≤—ã–±–æ—Ä–∫–∞ –±—É–¥–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, 

```
script_test.sh access.log 8 5 all

script_test.sh access.log 8 5
```
