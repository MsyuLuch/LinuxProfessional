# **–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ18**

üîñ–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–ª—è –∫—É—Ä—Å–∞ [Administrator Linux.Professional](https://otus.ru/lessons/linux-professional/)

## **–°–µ—Ç–µ–≤–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è**
 
[https://github.com/erlong15/otus-linux/tree/network](https://github.com/erlong15/otus-linux/tree/network)

Vagrantfile —Å –Ω–∞—á–∞–ª—å–Ω—ã–º  –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ–º —Å–µ—Ç–∏

- inetRouter 
- centralRouter
- centralServer

**–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

***–°–µ—Ç—å office1***

192.168.2.0/26 - dev

192.168.2.64/26 - test servers

192.168.2.128/26 - managers

192.168.2.192/26 - office hardware

***–°–µ—Ç—å office2***

192.168.1.0/25 - dev

192.168.1.128/26 - test servers

192.168.1.192/26 - office hardware


***–°–µ—Ç—å central***

192.168.0.0/28 - directors

192.168.0.32/28 - office hardware

192.168.0.64/26 - wifi

Office1 ---\
              
              -----> Central --IRouter --> internet
              
Office2----/

**–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å**
- –ù–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –ø–æ–¥—Å–µ—Ç–∏
- –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ –≤ –∫–∞–∂–¥–æ–π –ø–æ–¥—Å–µ—Ç–∏, –≤–∫–ª—é—á–∞—è —Å–≤–æ–±–æ–¥–Ω—ã–µ
- –£–∫–∞–∑–∞—Ç—å broadcast –∞–¥—Ä–µ—Å –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥—Å–µ—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–∞–∑–±–∏–µ–Ω–∏–∏

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å**
- –°–æ–µ–¥–∏–Ω–∏—Ç—å –æ—Ñ–∏—Å—ã –≤ —Å–µ—Ç—å —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–µ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥
- –í—Å–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ä–æ—É—Ç–µ—Ä—ã –¥–æ–ª–∂–Ω—ã —Ö–æ–¥–∏—Ç—å –≤ –∏–Ω–µ—Ç —á–µ—Ä–∑ inetRouter
- –í—Å–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞
- –£ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç –Ω–∞ –Ω–∞—Ç (eth0), –∫–æ—Ç–æ—Ä—ã–π –≤–∞–≥—Ä–∞–Ω—Ç –ø–æ–¥–Ω–∏–º–∞–µ—Ç –¥–ª—è —Å–≤—è–∑–∏
- –ü—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä–≤–µ–π—Å–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

# **–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

–ó–¥–µ—Å—å:
- `readme.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
- `VagrantFile` - —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è `Vagrant`

# **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è ‚Ññ18**

| 	 –°–µ—Ç—å    |  network 	|   min IP	|   max IP	|   hosts	|   direct broadcast	|   mask	|
|---	 |---	|---	|---	|---	|---	|---	|
|  office1 - dev            |   192.168.2.0/26	|   192.168.2.1	    |   192.168.2.62	|   62	|   192.168.2.63	|   255.255.255.192	|
|  office1 - test servers	|   192.168.2.64/26	|   192.168.2.65	|   192.168.2.126	|   62	|   192.168.2.127	|   255.255.255.192	|
|  office1 - managers    	|   192.168.2.128/26|   192.168.2.129	|   192.168.2.190	|   62	|   192.168.2.191	|   255.255.255.192	|
|  office1 - hardware     	|   192.168.2.192/26|   192.168.2.193	|   192.168.2.254	|   62	|   192.168.2.255	|   255.255.255.192 |

| 	 –°–µ—Ç—å    |  network 	|   min IP	|   max IP	|   hosts	|   direct broadcast	|   mask	|
|---	 |---	|---	|---	|---	|---	|---	|
|  office2 - dev            |   192.168.1.0/25	|   192.168.1.1	    |   192.168.1.126	|   126	|   192.168.1.127	|   255.255.255.128	|
|  office2 - test servers	|   192.168.1.128/26|   192.168.1.129	|   192.168.1.190	|   62	|   192.168.1.191	|   255.255.255.192	|
|  office2 - hardware    	|   192.168.1.192/26|   192.168.1.193	|   192.168.1.254 	|   62	|   192.168.1.255	|   255.255.255.192	|


–ò—Å–ø—Ä–∞–≤–∏–º –º–∞—Å–∫—É –¥–ª—è `central - directors`  –∏ `central - hardware` —Å–µ—Ç–∏:

| 	 –°–µ—Ç—å    |  network 	|   min IP	|   max IP	|   hosts	|   direct broadcast	|   mask	|
|---	 |---	|---	|---	|---	|---	|---	|
|  central - directors  |   192.168.0.0/27	|   192.168.0.1     |   192.168.0.30	|   30	|   192.168.0.31	|   255.255.255.224 	|
|  central - hardware	|   192.168.0.32/27 |   192.168.0.33	|   192.168.0.62	|   30	|   192.168.0.63	|   255.255.255.224 	|
|  central - wifi   	|   192.168.0.64/26	|   192.168.0.65 	|   192.168.0.126	|   62	|   192.168.0.127 	|   255.255.255.192 	|


| 	 –°–µ—Ç—å    |  network 	|   min IP	|   max IP	|   hosts	|   direct broadcast	|   mask	|
|---	 |---	|---	|---	|---	|---	|---	|
|  —Å–≤–æ–±–æ–¥–Ω–∞—è    |   192.168.0.128/25	|   192.168.0.129    |   192.168.0.254 	|   126	|   192.168.0.255	|   255.255.255.128  	|

–°—Ö–µ–º–∞ —Å–µ—Ç–∏:

![Schema](https://github.com/MsyuLuch/LinuxProfessional/blob/main/homework-18/schema.jpg)

–í—ã–ø–æ–ª–Ω—è–µ–º Vagrantfile

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ç–∏:
```
yum install net-tools -y
yum install traceroute -y
```

–û—Ç–∫–ª—é—á–∞–µ–º –º–∞—Ä—à—Ä—É—Ç –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é —É –≤—Å–µ—Ö –º–∞—à–∏–Ω:
```
echo "DEFROUTE=no" >> /etc/sysconfig/network-scripts/ifcfg-eth0 
```

–¢–∞–∫ –∂–µ –≤ /etc/sysctl.conf –¥–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–∏, —Ä–∞–∑—Ä–µ—à–∞—é—â–∏–µ —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ –ø–∞–∫–µ—Ç–æ–≤:
```
echo net.ipv4.conf.all.forwarding=1  >> /etc/sysctl.conf
```

–î–æ–±–∞–≤–ª—è–µ–º –≤ —Ñ–∞–π–ª `hosts` –∏–º–µ–Ω–∞ –º–∞—à–∏–Ω –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```
192.168.255.1 inetRouter
192.168.0.1 centralRouter
192.168.0.10 centralServer
192.168.2.1 office1Router
192.168.2.10 office1Server
192.168.1.1 office2Router
192.168.1.10 office2Server
```
–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–∞—Ä—à—Ä—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω, 
–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ inetRouter

inetRouter:
```
[vagrant@inetRouter ~]$ netstat -nr
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
0.0.0.0         10.0.2.2        0.0.0.0         UG        0 0          0 eth0
10.0.2.0        0.0.0.0         255.255.255.0   U         0 0          0 eth0
192.168.0.0     192.168.255.2   255.255.0.0     UG        0 0          0 eth1
192.168.255.0   0.0.0.0         255.255.255.252 U         0 0          0 eth1
```

centralRouter:
```
[vagrant@centralRouter ~]$ netstat -nr
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
0.0.0.0         192.168.255.1   0.0.0.0         UG        0 0          0 eth1
10.0.2.0        0.0.0.0         255.255.255.0   U         0 0          0 eth0
192.168.0.0     0.0.0.0         255.255.255.224 U         0 0          0 eth2
192.168.0.32    0.0.0.0         255.255.255.224 U         0 0          0 eth3
192.168.0.64    0.0.0.0         255.255.255.192 U         0 0          0 eth4
192.168.1.0     192.168.253.2   255.255.255.0   UG        0 0          0 eth1
192.168.2.0     192.168.254.2   255.255.255.0   UG        0 0          0 eth1
192.168.253.0   0.0.0.0         255.255.255.252 U         0 0          0 eth1
192.168.254.0   0.0.0.0         255.255.255.252 U         0 0          0 eth1
192.168.255.0   0.0.0.0         255.255.255.252 U         0 0          0 eth1
```

office1Router:
```
[vagrant@office1Router ~]$ netstat -nr
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
0.0.0.0         192.168.254.1   0.0.0.0         UG        0 0          0 eth1
10.0.2.0        0.0.0.0         255.255.255.0   U         0 0          0 eth0
192.168.2.0     0.0.0.0         255.255.255.192 U         0 0          0 eth2
192.168.2.64    0.0.0.0         255.255.255.192 U         0 0          0 eth3
192.168.2.128   0.0.0.0         255.255.255.192 U         0 0          0 eth4
192.168.2.192   0.0.0.0         255.255.255.192 U         0 0          0 eth5
192.168.254.0   0.0.0.0         255.255.255.252 U         0 0          0 eth1
```

office2Router:
```
[vagrant@office2Router ~]$ netstat -nr
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
0.0.0.0         192.168.253.1   0.0.0.0         UG        0 0          0 eth1
10.0.2.0        0.0.0.0         255.255.255.0   U         0 0          0 eth0
192.168.1.0     0.0.0.0         255.255.255.128 U         0 0          0 eth2
192.168.1.128   0.0.0.0         255.255.255.192 U         0 0          0 eth3
192.168.1.192   0.0.0.0         255.255.255.192 U         0 0          0 eth4
192.168.253.0   0.0.0.0         255.255.255.252 U         0 0          0 eth1
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ä—à—Ä—É—Ç –ø–∞–∫–µ—Ç–æ–≤ –¥–æ `ya.ru` –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤

office1Server:
```
[vagrant@office1Server ~]$  traceroute ya.ru
traceroute to ya.ru (87.250.250.242), 30 hops max, 60 byte packets
 1  office1Router (192.168.2.1)  0.423 ms  0.402 ms  0.381 ms
 2  192.168.254.1 (192.168.254.1)  0.468 ms  0.529 ms  0.512 ms
 3  inetRouter (192.168.255.1)  0.676 ms  0.656 ms  0.681 ms
```

office2Server:
```
[vagrant@office2Server ~]$  traceroute ya.ru
traceroute to ya.ru (87.250.250.242), 30 hops max, 60 byte packets
 1  office2Router (192.168.1.1)  0.389 ms  0.354 ms  0.333 ms
 2  192.168.253.1 (192.168.253.1)  0.560 ms  0.541 ms  0.606 ms
 3  inetRouter (192.168.255.1)  0.782 ms  0.762 ms  1.066 ms
```

centralServer:
```
[vagrant@centralServer ~]$ traceroute ya.ru
traceroute to ya.ru (87.250.250.242), 30 hops max, 60 byte packets
 1  centralRouter (192.168.0.1)  0.367 ms  0.318 ms  0.253 ms
 2  inetRouter (192.168.255.1)  0.546 ms  0.657 ms  0.577 ms
```