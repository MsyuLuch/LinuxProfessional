# **–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ2**

üîñ–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–ª—è –∫—É—Ä—Å–∞ [Administrator Linux.Professional](https://otus.ru/lessons/linux-professional/)

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

- **VirtualBox** - —Å—Ä–µ–¥–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏, –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã;
- **Vagrant** - –ü–û –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—Ä–µ–¥—ã –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è *VirtualBox*; (https://www.vagrantup.com/downloads.html);
- **mdadm** - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º–∏ RAID-–º–∞—Å—Å–∏–≤–∞–º–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π; 

# **–¶–µ–ª—å** 
 
–ü–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —Ä–∞–±–æ—Ç–æ–π —É—Ç–∏–ª–∏—Ç—ã –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö RAID-–º–∞—Å—Å–∏–≤–æ–≤:

- –¥–æ–±–∞–≤–∏—Ç—å –≤ Vagrantfile –µ—â–µ –¥–∏—Å–∫–æ–≤;
- —Å–æ–±—Ä–∞—Ç—å R0/R5/R10 –Ω–∞ –≤—ã–±–æ—Ä;
- –ø—Ä–æ–ø–∏—Å–∞—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–π–¥ –≤ –∫–æ–Ω—Ñ, —á—Ç–æ–±—ã —Ä–µ–π–¥ —Å–æ–±–∏—Ä–∞–ª—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ;
- —Å–æ–∑–¥–∞—Ç—å GPT —Ä–∞–∑–¥–µ–ª –∏ 5 –ø–∞—Ä—Ç–∏—Ü–∏–π;
- –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—É–Ω–∫—Ç–æ–≤, –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –≤ VagrantFile
 
# **–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç https://github.com/MsyuLuch/LinuxProfessional/tree/main/homework-2

–ó–¥–µ—Å—å:
- `readme.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
- `Vagrantfile` - —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è `Vagrant`
- `Script.sh` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–π–¥–∞, –∫–æ–Ω—Ñ –¥–ª—è –∞–≤—Ç–æ—Å–±–æ—Ä–∫–∏ —Ä–µ–π–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
---
new:
- `Vagrantfile` - —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è `Vagrant` (—Å—Ä–∞–∑—É —Å–æ–±–∏—Ä–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º —Ä–µ–π–¥–æ–º –∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏)

---
# **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è ‚Ññ2**

–î–æ–±–∞–≤–∏–º –≤ VagrantFile 5 –¥–∏—Å–∫–æ–≤ –¥–ª—è —Å–±–æ—Ä–∫–∏ RAID5:

```
:disks => {
        :sata1 => {
            :dfile => './sata1.vdi',
            :size => 250,
            :port => 1
        },
        :sata2 => {
            :dfile => './sata2.vdi',
            :size => 250,
            :port => 2
        },
        :sata3 => {
            :dfile => './sata3.vdi',
            :size => 250,
            :port => 3
        },
        :sata4 => {
            :dfile => './sata4.vdi',
            :size => 250,
            :port => 4
        },
      :sata5 => {
            :dfile => './sata5.vdi',
            :size => 250,
            :port => 5
        }
```

–ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –∏ –ª–æ–≥–∏–Ω–∏–º—Å—è:
```
vagrant up
vagrant ssh
```

–£—Ç–∏–ª–∏—Ç—ã mdadm, smartmontools, hdparm, gdisk —Å—Ç–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –í–ú:
```
box.vm.provision "shell", inline: <<-SHELL
	      mkdir -p ~root/.ssh
              cp ~vagrant/.ssh/auth* ~root/.ssh
	      yum install -y mdadm smartmontools hdparm gdisk
  	  SHELL
```
–ó–∞–Ω—É–ª–∏–º –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —Å—É–ø–µ—Ä–±–ª–æ–∫–∏:
```
mdadm --zero-superblock --force /dev/sd{b,c,d,e,f}
```
–°–æ–∑–¥–∞–µ–º RAID5 (–æ–ø—Ü–∏—è -l):
```
mdadm --create --verbose /dev/md0 -l 5 -n 5 /dev/sd{b,c,d,e,f}
```
–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–π RAID5:
```
cat /proc/mdstat
mdadm -D /dev/md0
```
–°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª mdadm.conf:
```
echo "DEVICE partitions" > /etc/mdadm/mdadm.conf
mdadm --detail --scan --verbose | awk '/ARRAY/ {print}' >> /etc/mdadm/mdadm.conf
```
–° –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã parted —Å–æ–∑–¥–∞–µ–º —Ä–∞–∑–¥–µ–ª GPT –Ω–∞ RAID5:
```
parted -s /dev/md0 mklabel gpt
```
–î–µ–ª–∏–º –µ–≥–æ –Ω–∞ 5 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π:
```
parted /dev/md0 mkpart primary ext4 0% 20%
parted /dev/md0 mkpart primary ext4 20% 40%
parted /dev/md0 mkpart primary ext4 40% 60%
parted /dev/md0 mkpart primary ext4 60% 80%
parted /dev/md0 mkpart primary ext4 80% 100%
```
–° –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã mkfs.ext4 —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã ext4 –Ω–∞ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏:
```
for i in $(seq 1 5); do sudo mkfs.ext4 /dev/md0p$i; done
```
–ú–æ–Ω—Ç–∏—Ä—É–µ–º –∏—Ö –ø–æ –∫–∞—Ç–∞–ª–æ–≥–∞–º:
```
mkdir -p /raid/part{1,2,3,4,5}
 for i in $(seq 1 5); do mount /dev/md0p$i /raid/part$i; done
```
–ó–∞–Ω–æ—Å–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–Ω–æ–≤—å —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö –≤ /etc/fstab, —á—Ç–æ–±—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏, —Ä–∞–∑–¥–µ–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å:
```
echo "#RAID" >> /etc/fstab
for i in $(seq 1 5); do echo `sudo blkid /dev/md0p$i | awk '{print $2}'` /u0$i ext4 defaults 0 0 >> /etc/fstab; done
```
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤ —Ñ–∞–π–ª–µ /ect/fstab –±—É–¥—É—Ç —Å—Ç—Ä–æ–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–¥–∞:
```
UUID="8fc9d795-640d-4886-9ec0-b41583608314" /u01 ext4 defaults 0 0
```
–≥–¥–µ UUID —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞

–ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ—à–ª–æ —É–¥–∞—á–Ω–æ —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é RAID5 –∏ —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ —Å–∫—Ä–∏–ø—Ç https://github.com/MsyuLuch/LinuxProfessional/blob/main/homework-2/script.sh

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∞ –í–ú —Å–æ–±—Ä–∞–Ω–Ω–æ–π —Å –Ω—É–ª—è, —Å –ø–æ–º–æ—â—å—é VagrantFile https://github.com/MsyuLuch/LinuxProfessional/blob/main/homework-2/VagrantFile

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é RAID5 –≤ VagrantFile:
```
       box.vm.provision "shell", inline: <<-SHELL
            mkdir -p ~root/.ssh
                cp ~vagrant/.ssh/auth* ~root/.ssh
            yum install -y mdadm smartmontools hdparm gdisk
            mdadm --zero-superblock --force /dev/sd{b,c,d,e,f}
            mdadm --create --verbose --force /dev/md0 -l 5 -n 5 /dev/sd{b,c,d,e,f}
            cat /proc/mdstat
            mkdir /etc/mdadm/
            echo "DEVICE partitions" > /etc/mdadm/mdadm.conf
            mdadm --detail --scan --verbose | awk '/ARRAY/ {print}' >> /etc/mdadm/mdadm.conf
            parted -s /dev/md0 mklabel gpt
            parted /dev/md0 mkpart primary ext4 0% 20%
            parted /dev/md0 mkpart primary ext4 20% 40%
            parted /dev/md0 mkpart primary ext4 40% 60%
            parted /dev/md0 mkpart primary ext4 60% 80%
            parted /dev/md0 mkpart primary ext4 80% 100%
            for i in $(seq 1 5); do sudo mkfs.ext4 /dev/md0p$i; done
            mkdir -p /raid/part{1,2,3,4,5}
            for i in $(seq 1 5); do mount /dev/md0p$i /raid/part$i; done
            echo "#RAID" >> /etc/fstab
            for i in $(seq 1 5); do echo `sudo blkid /dev/md0p$i | awk '{print $2}'` /u0$i ext4 defaults 0 0 >> /etc/fstab; done
            sed -i '65s/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
            systemctl restart sshd
        SHELL
```
—Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–æ–≤—ã–π Vagrantfile https://github.com/MsyuLuch/LinuxProfessional/blob/main/homework-2/new/VagrantFile
