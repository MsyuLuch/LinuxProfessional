# **–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ7**

üîñ–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–ª—è –∫—É—Ä—Å–∞ [Administrator Linux.Professional](https://otus.ru/lessons/linux-professional/)

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

- **VirtualBox** - —Å—Ä–µ–¥–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏, –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã;
- **Vagrant** - –ü–û –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—Ä–µ–¥—ã –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è *VirtualBox*; (https://www.vagrantup.com/downloads.html);

# **–¶–µ–ª—å**
 
## **–†–∞–±–æ—Ç–∞ —Å –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º**
 
- –ü–æ–ø–∞—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –±–µ–∑ –ø–∞—Ä–æ–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å LVM, –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å VG.
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å –≤ initrd.

# **–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç https://github.com/MsyuLuch/LinuxProfessional/tree/main/homework-7

–ó–¥–µ—Å—å:
- `readme.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å LVM, –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å VG
- `Vagrantfile` - —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è `Vagrant`
- `rn-root-vg.sh` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è VG –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
 3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å –≤ initrd
- `Vagrantfile` - —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è `Vagrant`
- `add-module.sh` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥—É–ª—è –≤ initrd

# **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è ‚Ññ7**

***1. –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è root –Ω–∞ CentOS 8***

–í–∫–ª—é—á–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä CentOS.
–ö–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ –º–µ–Ω—é GRUB, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é —è–¥—Ä–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å, 
–∏ –Ω–∞–∂–º–∏—Ç–µ `e`, —á—Ç–æ–±—ã –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∑–∞–≥—Ä—É–∑–æ—á–Ω—É—é –∑–∞–ø–∏—Å—å.
–í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–≥—Ä—É–∑–æ—á–Ω—É—é –∑–∞–ø–∏—Å—å,–¥–æ–±–∞–≤–∏–≤ `rd.break`
–ù–∞–∂–º–∏—Ç–µ `Ctrl + x`, —á—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ –∞–≤–∞—Ä–∏–π–Ω—ã–π, –æ–¥–Ω–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º.
–í–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –¥–ª—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ—Ä–Ω–µ–≤–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (/) –≤ —Ä–µ–∂–∏–º–µ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏:
```
mount -o remount,rw /sysroot
```
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥ `/sysroot` –∏ —Å–±—Ä–æ—Å—å—Ç–µ –ø–∞—Ä–æ–ª—å `root`.
```
chroot /sysroot/
```
–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `root`:
```
passwd root
```
–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è `root` –≤–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–º–∞—Ä–∫–∏—Ä–æ–≤–∫—É SELinux –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ:
```
touch /.autorelabel
```
–î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä CentOS –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ:
```
exit
exit
reboot
```
–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–µ—Ä–µ–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ SELinux.
–≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ –∂–µ—Å—Ç–∫–æ–≥–æ –¥–∏—Å–∫–∞.
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä CentOS 8 —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º root!

***2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å LVM, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å VG***

–ó–∞–ø—É—Å–∫–∞–µ–º –í–ú –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```
# lsblk
NAME                   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                      8:0    0   64G  0 disk
‚îî‚îÄsda1                   8:1    0   64G  0 part
  ‚îú‚îÄvagrant--vg-root   253:0    0   63G  0 lvm  /
  ‚îî‚îÄvagrant--vg-swap_1 253:1    0  980M  0 lvm  [SWAP]

# vgs
  VG         #PV #LV #SN Attr   VSize   VFree
  vagrant-vg   1   2   0 wz--n- <64.00g    0

```

–í—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç `rn-root-vg.sh` —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

***–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞***

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å VG –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–∞–Ω–¥—É
```
vgrename ${oldvg} ${newvg}
```

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ –≤ —Ñ–∞–π–ª–µ `/etc/fstab` : 
```
sed -i "s/${oldvg}/${newvg}/g" /etc/fstab
sed -i "s/${oldvgdash}/${newvgdash}/g" /etc/fstab
```
–û–±–Ω–æ–≤–∏–º VG –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö GRUB:
```
sed -i "s/${oldvg}/${newvg}/g" /boot/grub/grub.cfg
sed -i "s/${oldvgdash}/${newvgdash}/g" /boot/grub/grub.cfg

sed -i "s/${oldvg}/${newvg}/g" /boot/grub/menu.lst
sed -i "s/${oldvgdash}/${newvgdash}/g" /boot/grub/menu.lst

sed -i "s/${oldvg}/${newvg}/g" /etc/initramfs-tools/conf.d/resume
sed -i "s/${oldvgdash}/${newvgdash}/g" /etc/initramfs-tools/conf.d/resume
```
–û–±–Ω–æ–≤–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–∑ —è–¥—Ä–∞ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
```
update-initramfs -c -k all
```
–û—Å–≤–æ–±–æ–¥–∏–º swap (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏):
```
swapoff -a && swapon -a
```

***3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å –≤ initrd***

dracut - —É—Ç–∏–ª–∏—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è initramfs (initial RAM disk image, –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å —Ñ–∞–π–ª —Å –æ–±—Ä–∞–∑–æ–º —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã), –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Linux –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∫–æ—Ä–Ω–µ–≤–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã. 

–°–æ–∑–¥–∞–µ–º —Å–≤–æ—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è –≤ `/usr/lib/dracut/modules.d/` –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ—ë –¥–≤–∞ —Å–∫—Ä–∏–ø—Ç–∞ `module-setup.sh` –∏ `test.sh`:
```
mkdir /usr/lib/dracut/modules.d/01test
cd /usr/lib/dracut/modules.d/01test
```
```
cat >module-setup.sh<<EOF

#------------------------------------------------
#!/bin/bash

check() {
     return 0
}
depends() {
     return 0
}
install() {
     inst_hook cleanup 00 "/usr/lib/dracut/modules.d/01test/test.sh"
}
#------------------------------------------------
EOF
```

```
cat >test.sh<<EOF
#------------------------------------------------
#!/bin/bash
exec 0<>/dev/console 1<>/dev/console 2<>/dev/console
cat <<'msgend'
 ___________________
< I'm dracut module >
 -------------------
    \
     \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/
msgend
sleep 10
echo " continuing...."
#------------------------------------------------
EOF
```

–û–±–∞ —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ª–∞–µ–º –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏:
```
chmod +x module-setup.sh && chmod +x test.sh
```
–°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π initramfs: 
```
dracut -f -v
```
–£–±–µ–¥–∏–º—Å—è —á—Ç–æ –º–æ–¥—É–ª—å –¥–æ–±–∞–≤–ª–µ–Ω:
```
lsinitrd -m /boot/initramfs-$(uname -r).img | grep test
```